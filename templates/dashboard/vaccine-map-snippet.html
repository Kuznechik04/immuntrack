<!-- Map-DIV -->
<div id="map" style="width: 100%; height: 600px;"></div>
<!-- WICHTIG: zuerst mapdata.js, dann worldmap.js -->
<script src="{{ url_for('static', filename='map/mapdata.js') }}"></script>
<script src="{{ url_for('static', filename='map/worldmap.js') }}"></script>
 
<!-- Impfstatus von Flask -->
<script>
  window.impfstatus = {{ impfstatus | tojson | safe }};
  console.log("Impfstatus geladen:", window.impfstatus);
 
  const farben = ["#4caf50", "#ffeb3b", "#ff9800", "#f44336"];
  const mapcolors = {};

  const iso3to2 = {
  DEU: "DE",
  FRA: "FR",
  ITA: "IT",
  USA: "US",
  LKA: "LK"
  // erweitern nach Bedarf
};

 
  Object.entries(window.impfstatus).forEach(([iso, fehlend]) => {

    const key = iso3to2[iso] || iso;   // fallback, falls schon ISO2

    let farbe;
    if (fehlend === 0) farbe = farben[0];
    else if (fehlend <= 2) farbe = farben[1];
    else if (fehlend <= 4) farbe = farben[2];
    else farbe = farben[3];
    mapcolors[key] = farbe;
    if (typeof simplemaps_worldmap_mapdata.state_specific[key] === "undefined") {
    simplemaps_worldmap_mapdata.state_specific[key] = { name: key };
  }
  simplemaps_worldmap_mapdata.state_specific[key].color = farbe;
  });
 
  window.onload = function () {
    if (typeof mapSettings !== "undefined") {
      mapSettings.general.fill = "#DDDDDD";
      mapSettings.state_specific = mapSettings.state_specific || {};
      for (const [iso, farbe] of Object.entries(mapcolors)) {
        console.log("Setze Farbe fÃ¼r", iso, "auf", farbe);
        if (!mapSettings.state_specific[iso]) mapSettings.state_specific[iso] = {};
        mapSettings.state_specific[iso].color = farbe;
      }
    } else {
      console.error("mapSettings ist nicht definiert!");
    }
  };
</script>
 

